clc
clear all
delfvvm = @(V,m) (21/50*m^3*exp(-1/20*V)/(7/100*exp(-1/20*V)+1/(exp(3-1/10*V)+1))*(V-115)+42/5*m^3*exp(-1/20*V)/(7/100*exp(-1/20*V)+1/(exp(3-1/10*V)+1))^2*(V-115)*(-7/2000*exp(-1/20*V)+1/10/(exp(3-1/10*V)+1)^2*exp(3-1/10*V))-42/5*m^3*exp(-1/20*V)/(7/100*exp(-1/20*V)+1/(exp(3-1/10*V)+1))+9/25/(exp(1-1/10*V)-1)/((1/10-1/100*V)/(exp(1-1/10*V)-1)+1/8*exp(-1/80*V))^4*(V+12)-18/5*(1/10-1/100*V)/(exp(1-1/10*V)-1)^2/((1/10-1/100*V)/(exp(1-1/10*V)-1)+1/8*exp(-1/80*V))^4*(V+12)*exp(1-1/10*V)+144*(1/10-1/100*V)/(exp(1-1/10*V)-1)/((1/10-1/100*V)/(exp(1-1/10*V)-1)+1/8*exp(-1/80*V))^5*(V+12)*(-1/100/(exp(1-1/10*V)-1)+1/10*(1/10-1/100*V)/(exp(1-1/10*V)-1)^2*exp(1-1/10*V)-1/640*exp(-1/80*V))-36*(1/10-1/100*V)/(exp(1-1/10*V)-1)/((1/10-1/100*V)/(exp(1-1/10*V)-1)+1/8*exp(-1/80*V))^4-3/10);
delfvm  = @(V,m) (-126/5*m^2*exp(-1/20*V)/(7/100*exp(-1/20*V)+1/(exp(3-1/10*V)+1))*(V-115));
delfmv  = @(V,m) (-1/10/(exp(5/2-1/10*V)-1)*(1-m)+1/10*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)^2*(1-m)*exp(5/2-1/10*V)+2/9*m*exp(-1/18*V));
delfmm  = @(V,m) (-(5/2-1/10*V)/(exp(5/2-1/10*V)-1)-4*exp(-1/18*V));


delfvvh = @(V,h) (12/(exp(5/2-1/10*V)-1)/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^3*h*(V-115)-12*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)^2/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^3*h*(V-115)*exp(5/2-1/10*V)+360*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^4*h*(V-115)*(-1/10/(exp(5/2-1/10*V)-1)+1/10*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)^2*exp(5/2-1/10*V)-2/9*exp(-1/18*V))-120*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^3*h+9/25/(exp(1-1/10*V)-1)/((1/10-1/100*V)/(exp(1-1/10*V)-1)+1/8*exp(-1/80*V))^4*(V+12)-18/5*(1/10-1/100*V)/(exp(1-1/10*V)-1)^2/((1/10-1/100*V)/(exp(1-1/10*V)-1)+1/8*exp(-1/80*V))^4*(V+12)*exp(1-1/10*V)+144*(1/10-1/100*V)/(exp(1-1/10*V)-1)/((1/10-1/100*V)/(exp(1-1/10*V)-1)+1/8*exp(-1/80*V))^5*(V+12)*(-1/100/(exp(1-1/10*V)-1)+1/10*(1/10-1/100*V)/(exp(1-1/10*V)-1)^2*exp(1-1/10*V)-1/640*exp(-1/80*V))-36*(1/10-1/100*V)/(exp(1-1/10*V)-1)/((1/10-1/100*V)/(exp(1-1/10*V)-1)+1/8*exp(-1/80*V))^4-3/10);
delfvh  = @(V,h) (-120*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^3*(V-115));
delfhv  = @(V,h) (-7/2000*exp(-1/20*V)*(1-h)-1/10/(exp(3-1/10*V)+1)^2*h*exp(3-1/10*V));
delfhh  = @(V,h) (-7/100*exp(-1/20*V)-1/(exp(3-1/10*V)+1));


delfvvn = @(V,n) (21/25/(exp(5/2-1/10*V)-1)/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^3*exp(-1/20*V)/(7/100*exp(-1/20*V)+1/(exp(3-1/10*V)+1))*(V-115)-21/25*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)^2/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^3*exp(-1/20*V)/(7/100*exp(-1/20*V)+1/(exp(3-1/10*V)+1))*(V-115)*exp(5/2-1/10*V)+126/5*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^4*exp(-1/20*V)/(7/100*exp(-1/20*V)+1/(exp(3-1/10*V)+1))*(V-115)*(-1/10/(exp(5/2-1/10*V)-1)+1/10*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)^2*exp(5/2-1/10*V)-2/9*exp(-1/18*V))+21/50*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^3*exp(-1/20*V)/(7/100*exp(-1/20*V)+1/(exp(3-1/10*V)+1))*(V-115)+42/5*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^3*exp(-1/20*V)/(7/100*exp(-1/20*V)+1/(exp(3-1/10*V)+1))^2*(V-115)*(-7/2000*exp(-1/20*V)+1/10/(exp(3-1/10*V)+1)^2*exp(3-1/10*V))-42/5*(5/2-1/10*V)/(exp(5/2-1/10*V)-1)/((5/2-1/10*V)/(exp(5/2-1/10*V)-1)+4*exp(-1/18*V))^3*exp(-1/20*V)/(7/100*exp(-1/20*V)+1/(exp(3-1/10*V)+1))-36*n^4-3/10);
delfvn  = @(V,n) (-144*n^3*(V+12));
delfnv  = @(V,n) (-1/100/(exp(1-1/10*V)-1)*(1-n)+1/10*(1/10-1/100*V)/(exp(1-1/10*V)-1)^2*(1-n)*exp(1-1/10*V)+1/640*n*exp(-1/80*V));
delfnn  = @(V,n) (-(1/10-1/100*V)/(exp(1-1/10*V)-1)-1/8*exp(-1/80*V));

%V  = 18.46;   
%m  = 0.3304; 
%h  = 0.1038;  %correspond to current = 100
%n  = 0.5995;


V = 31.3;
m = 0.6563;       %correspond to Iext = 400 
h = 0.02664;
n = 0.741; 

Jacmatm = [delfvvm(V,m), delfvm(V,m); delfmv(V,m), delfmm(V,m)];
Jacmath = [delfvvh(V,h), delfvh(V,h); delfhv(V,h), delfhh(V,h)];
Jacmatn = [delfvvn(V,n), delfvn(V,n); delfnv(V,n), delfnn(V,n)];

trm = Jacmatm(1,1) + Jacmatm(2,2);
trh = Jacmath(1,1) + Jacmath(2,2);
trn = Jacmatn(1,1) + Jacmatn(2,2);

detm = det(Jacmatm);
deth = det(Jacmath);
detn = det(Jacmatn);